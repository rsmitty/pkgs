name: cni
steps:
  - sources:
      - url: https://github.com/containernetworking/plugins/releases/download/v0.8.5/cni-plugins-linux-amd64-v0.8.5.tgz
        destination: cni-plugins-amd64.tgz
        sha256: bd682ffcf701e8f83283cdff7281aad0c83b02a56084d6e601216210732833f9
        sha512: 497be012e1e3c605c467752ee5729de35d88afd7a0bfa237a6cf979413d65bda34865a8dd952ca1d32581bb5669d567c2c7f2d23dd92db3ba9101204583a8482
      - url: https://github.com/containernetworking/plugins/releases/download/v0.8.5/cni-plugins-linux-arm-v0.8.5.tgz
        destination: cni-plugins-arm64.tgz
        sha256: 86a868234045837cb3f5d58a0a4468ff42845d50b5e87bd128f050ef393d7495
        sha512: 3c03b76db4ec92c0121c22f27d552fd2323c70a14f82baac1ec22392baf8c6b55c453bbcd658fbd67a8468417d672478f01c8dab7766074c2d7536c9b60a1266
    install:
      - |
        mkdir -p /rootfs/opt/cni/bin

        case $ARCH in
            x86_64)
                tar -xzf cni-plugins-amd64.tgz -C /rootfs/opt/cni/bin
            ;;
            aarch64)
                tar -xzf cni-plugins-arm64.tgz -C /rootfs/opt/cni/bin
            ;;
            *)
                echo "unsupported arch ${ARCH}"
                exit 1
            ;;
        esac
finalize:
  - from: /rootfs
    to: /
